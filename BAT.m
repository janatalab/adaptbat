function outData = BAT(subject_id)% wrapper function for the BAT test% calls functions for IBI and phase preturbation tasks in random order%% 14 Sept 2016 - BH% randomize task ordertask_order = randperm(2);%% Graphics and audio initializationScreen('Preference', 'VisualDebugLevel', 1);Screen('Preference', 'SkipSyncTests', 1);%HideCursor;PsychDefaultSetup(2);%Set screen number to my one screen (this can detect multiple displays if%needed)screenNum = max(Screen('Screens'));%Define colorswhite = WhiteIndex(screenNum);grey = white / 2;black = BlackIndex(screenNum);% Keyboard InformationescapeKey = KbName('ESCAPE');NO = KbName('q'); % No (off beat) is q during experiment, and 0 in output fileYES = KbName('p'); % Yes (on beat) is p during experiment, and 1 in output filedownKey = KbName('DownArrow');%instruction_screen____________________________%Black screen appears first[window, rect] = PsychImaging('OpenWindow', screenNum, black);Screen('Flip',window);%Query frame durationifi = Screen('GetFlipInterval',window);% Query maximum priority leveltopPriorityLevel = MaxPriority(window);% Get the center coordinate of the window[X,Y] = RectCenter(rect);% Deliver instruction textScreen('TextSize',window, 30);Screen('TextFont',window,'Ariel');Screen('TextStyle', window, 1);textString = ['Please listen to each musical excerpt and judge whether ' ...  'the click track is on-beat or off-beat. \n\n\n Respond at the end of ' ...   'each musical excerpt by pressing Q if the tone is off-beat or P if ' ...   'the tone is on-beat. \n\n\n This should take about 7 minutes.'];DrawFormattedText(window, textString, 'center', 'center', white, 60);Screen('TextSize',window, 15);textString = '< Press any key to continue >';DrawFormattedText(window, textString, 'center', 1000, white);Screen('Flip', window);KbStrokeWait;tic%_____________________________resp_tbl = cell2table(cell(26,4), 'VariableNames', {'response','aug_cond',  'aug_trial','score'});%responses = zeros(26,4);Screen('TextSize',window, 30);textString = 'Press Q for off-beat, P for on-beat';DrawFormattedText(window, textString, 'center', 'center', white)Screen('Flip', window);WaitSecs(2)% Initialize SounddriverInitializePsychSound(1);% Number of channels and Frequency of the soundnrchannels = 2;freq = 48000;% How many times we wish to play the soundrepetitions = 1;% Start immediately (0 = immediately)startCue = 0;% Should we wait for the device to really start (1 = yes)% INFO: See help PsychPortAudiowaitForDeviceStart = 1;% Open Psych-Audio port, with the follow arguements% (1) [] = default sound device% (2) 1 = sound playback only% (3) 1 = default level of latency% (4) Requested frequency in samples per second% (5) 2 = stereo putputpahandle = PsychPortAudio('Open', [], 1, 1, freq, nrchannels);% Set the volume to half for this demoPsychPortAudio('Volume', pahandle, 0.5);for i_order = 1:length(task_order)        if task_order(i_order) == 1        BAT_adaptive_ibi_v2(subject_id);            elseif task_order(i_order) == 2        BAT_adaptive_phase(subject_id);                end    end